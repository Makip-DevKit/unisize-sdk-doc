# SDKリファレンス（Swift）

## ドキュメントのバージョン情報
* 25/03/18 UnisizeBannerWebview Class の情報を追加。
* 25/02/25 一部内容追記。UnisizeBanner Class、UnisizeCVTag Class に `close()`を追加。
* 24/09/20 一部内容追記。UnisizeBanner Class の Delegate に`didBeidChanged()`を追加。
* 24/08/16 UnisizeBanner Class に customStyle 関連の情報を追記。
* 24/06/24 UnisizeBanner Class に CIバナー関連の情報を追加。UnisizeBanner Classの didUnsupported の内容を一部追記
* 24/05/31 リリースにあたり内容を一部変更
* 24/05/29 init() メソッドの sendErrorLog 追加
* 24/05/21 UnisizeCVTag Class 内容一部更新
* 24/05/20 初版

---

## unisizeSDK.xcframeworkのインポート
SDK を使用する Swift ファイルの先頭（import 文のある箇所）に、`import unisizeSDK`を記述します。<br>

```swift
import unisizeSDK
```
  
<hr>
  
## UnisizeBannerWebview Class（v2.0以降）

| Class               | 継承                |
| :------------------ | :------------------ |
| UnisizeBannerWebview       | WKWebView |  
  
v2.0 より追加された unisize バナー表示、unisize アンケート画面表示用 Class。  
EC アプリケーションの商品詳細画面のストーリーボード、ViewController に配置して、初期化のタイミングで各種パラメーターを渡すことで、unisize バナーを表示することができます。unisize バナーの表示から、unisize アンケート画面の表示、アンケート結果を反映したサイズレコメンド処理までを一括で含んでいます。  
UnisizeBannerWebview Class を使用することで Android 版に近い形での実装が可能になりました。また SwiftUI や Flutter での実装が、以前のバージョンと比べて実装しやすくなりました。
  
- 1つのインスタンスで1つのバナー表示に対応します。
- UnisizeBanner Class との違いは、1つのインスタンスで1つのバナーに対応する点です。Swift の場合、UnisizeBannerWebview Class／UnisizeBanner Class どちらでもバナーの実装は可能ですが、UnisizeBanner Class は下位バージョンとの互換として残しているため、将来のバージョンで廃止する可能性がございます。
- SwiftUI や Flutter など Swift ではない UI フレームワーク上で実装が可能となります。  
- UnisizeBannerWebview Class と UnisizeBanner Class の併用はできません。

  <br>
  
| メソッド、プロパティ、 Delegate  | 説明 | 種類 |
| :------------------ | :------------------ | :------------------ |
| [init()](#init-メソッド) | UnisizeBannerWebview Class の init メソッド。<br>（コンストラクタ） | メソッド<br>（コンストラクタ） |
| [setupParam()](#setupParam-メソッド) | パラメーターを再度設定してバナーの表示を更新します。 | メソッド |
| [reload()](#reload-メソッド) | unisize バナーをリロードします。 | メソッド |
| [close()](#close-メソッド) | UnisizeBannerWebview Class の deinit メソッド。deinit の際に呼び出している処理と同一です。 | メソッド |
| [func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFinish: String, bannerType: String)](#func-unisizebannerwebview_-banner-unisizebannerwebview-didfinish-string-bannertype-string) | UnisizeBanner class の処理完了時に実行される Delegate。 |  Delegate  |
| [func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFail: UnisizeError, bannerType: String)](#func-unisizebannerwebview_-banner-unisizebannerwebview-didfail-unisizeerror-bannertype-string) | UnisizeBannerWebview の処理失敗時に実行される Delegate。 |  Delegate  |
| [func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didResized: String, width: CGFloat, height: CGFloat, bannerType: String)](#func-unisizebannerwebview_-banner-unisizebannerwebview-didresized-string-width-cgfloat-height-cgfloat-bannertype-string) | UnisizeBanner のバナーのリサイズ時に実行される Delegate。 |  Delegate  |
| [func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didUnsupported: String](#func-unisizebannerwebview_-banner-unisizebannerwebview-didunsupported-string) | 対象商品が unisize 対象外の場合に実行される Delegate。 |  Delegate  |
| [func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didBeidChanged: String, recommendedItems: String, bannerType: String)](#func-unisizebannerwebview_-banner-unisizebannerwebview-didbeidchanged-string-recommendeditems-string-bannertype-string) | unisize の beid など unisize の CV タグに必要なデータの値の更新時に実行されます。 |  Delegate  |
| [func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didBannerClicked: String, bannerType: String)](#func-unisizebannerwebview_-banner-unisizebannerwebview-didbannerclicked-string-bannertype-string) | バナータップ時に実行されます。 |  Delegate  |
  
### init() メソッド
UnisizeBannerWebview Class の init メソッド（コンストラクタ）
TEXT バナー、EX バナー、CIバナーの表示に使用します。（1画面に対して1バナー、最大3つのバナーを配置可能） 
ストーリーボードに配置して接続するか、ViewControllerでインスタンスを生成します。
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| frame              | CGRect                 | 位置（origin） と サイズ（size） を指定します。
  
### setupParam() メソッド
バナーのパラメーターを設定します。  
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| parentView       | UIViewController       | バナークリック時に unisize アンケート画面の表示処理で必要となります。<br>UnisizeBannerWebview class を呼び出した ViewController（self）を渡します。 |
| bannerType              | String                 | 表示するバナータイプを設定します。（text、ex、ci） |
| bannerMode              | String                 | バナーモード。<br>・TEXTバナーとEXバナーを表示する場合：text,ex<br>・TEXTバナーのみ表示する場合：text<br>・EXバナーのみ表示する場合：ex<br>※ CIバナーの設定は不要です。 |
| cid              | String                 | クライアントID |
| itm              | String                 | アイテムID（アイテムごとに異なります） |
| cuid             | String?                | クライアントユーザーID<br>（ECアプリケーション（サイト）のユーザーログインID）<br>※ ユーザーがECアプリケーションにログインしている場合に必要となります。 |
| lang | String? | 表示言語<br>※ デフォルトは日本語：ja
| enableWebViewLog | Bool                   | console.log の内容を Xcode のコンソールに出力する
| enablePrintLog   | Bool                   | UnisizeBannerWebview Class のデバッグログを Xcode のコンソールに出力する
| sendErrorLog     | Bool                   | エラー発生時にエラーログをunisizeサーバーへ送信します
| delegate         | UnisizeBannerWebviewDelegate? |  Delegate を使用する場合は、selfを渡してください。
| customStyle      | String?                | バナーにカスタムスタイルを適用する場合に使用します。<br>cssを渡すことでバナーにカスタムスタイルを適用できます。<br>詳しくは付属のドキュメント「unisizeSDK Readme_iOS」の「バナーのカスタムスタイル適用について」を参照ください。（※）
  
* unisize では、バナーにカスタムスタイルを適用することで、unisize バナーのバージョンアップ時に表示崩れや不具合の原因となる可能性があるなどの点から、バナーのカスタマイズを推奨していません。ブランドイメージや、アプリの UI との兼ね合いで、どうしてもバナーカスタマイズが必要な場合に限定してご利用ください。
  
** バナーを3つ（TEXTバナー、EXバナー、CIバナー）配置する場合の実装例 **
```swift
    @IBOutlet weak var textBannerWebview: UnisizeBannerWebview!
    @IBOutlet weak var exBannerWebview: UnisizeBannerWebview!
    @IBOutlet weak var ciBannerWebview: UnisizeBannerWebview!

    override func viewDidLoad() {

        let bannerWebviews: [UnisizeBannerWebview?] = [textBannerWebview, exBannerWebview, ciBannerWebview]
        
        bannerWebviews.forEach { banner in
            banner?.translatesAutoresizingMaskIntoConstraints = false
            banner?.delegate = self
        }

        textBannerWebviewHeightConstraint = textBannerWebview?.heightAnchor.constraint(equalToConstant: 0)
        exBannerWebviewHeightConstraint = exBannerWebview?.heightAnchor.constraint(equalToConstant: 0)
        ciBannerWebviewHeightConstraint = ciBannerWebview?.heightAnchor.constraint(equalToConstant: 0)

        NSLayoutConstraint.activate([
            textBannerWebviewHeightConstraint,
            exBannerWebviewHeightConstraint,
            ciBannerWebviewHeightConstraint
        ])

        let bannerTypes: [(UnisizeBannerWebview?, String)] = [
            (textBannerWebview, "text"),
            (exBannerWebview, "ex"),
            (ciBannerWebview, "ci")
        ]

        let availableBannerTypes = bannerTypes.compactMap { banner, type in
            (banner != nil && type != "ci") ? type : nil
        }
        let bannerMode = availableBannerTypes.joined(separator: ",")
        
        bannerTypes.forEach { banner, type in
            if let banner = banner {
                setupBannerParam(banner: banner, bannerType: type, bannerMode: bannerMode)
            }
        }
    }

    func setupBannerParam(banner: UnisizeBannerWebview, bannerType: String, bannerMode: String) {
        banner.setupParam(
            parentView: self,
            bannerType: bannerType,
            bannerMode: bannerMode,
            cid: cid,
            itm: itm,
            cuid: cuid,
            lang: lang,
            enableWebViewLog: enableWebViewLog,
            enablePrintLog: enablePrintLog,
            sendErrorLog: sendErrorLog,
            delegate: self,
            customStyle: customStyle
        )
    }
```  
  
### reload() メソッド
unisize バナーをリロードします。  
  
通常SDKを使用する際に、reload() メソッドを使用することは想定していませんが、強制的にバナーを更新する必要がある場合のみ使用してください。  
  
※ パラメーターなし
  
### show() メソッド
unisize バナーを表示します。setupParam() でパラメーターを設定した後に実行します。

※ パラメーターなし  
  
### close() メソッド
unisize バナーの各変数を解放して閉じる処理を行います。  
deinit 時に呼び出している処理と同一になります。
  
通常 SDK を使用する際に、close() メソッドを使用することは想定していませんが、強制的に UnisizeBannerWebview Class を解放する必要がある場合のみ使用してください。
（商品詳細画面の ViewController を閉じるタイミングなど）  
  
※ パラメーターなし
  
###  Delegate  の実装
UnisizeBannerWebview class の完了時、バナーリサイズ時、エラー発生時などに、ECアプリケーション側で追加で処理を行う場合は、UnisizeBannerWebviewDelegate 内に実装を行います。  
バナーサイズ確定、バナー表示時にUIを調整したり、エラー発生時にユーザーに対して通知するといった場合に有用です。  
  
ECアプリケーションの商品詳細画面の ViewController で UnisizeBannerWebview class を初期化した後に、ViewController class（self）を渡して、extension 【商品詳細画面のViewController】: UnisizeBannerWebviewDelegate に下記を実装します。  

```swift
ECアプリケーションの商品詳細画面の ViewController に下記を実装

extension 【商品詳細画面のViewController】: UnisizeBannerWebviewDelegate {

    // unisize バナーの処理完了時に実行される
    func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFinish message: String, bannerType: String) {
        // ・・・ここに実行したいコードを実装します
    }
    
    // unisize バナーの処理失敗時に実行される
    func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFail errorObj: UnisizeError, bannerType: String) {
        // ・・・ここに実行したいコードを実装します
    }
    
    // unisize バナーのリザイズ時に実行される
    func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didResized message: String, width: CGFloat, height: CGFloat, bannerType: String) {
        // ・・・ここに実行したいコードを実装します
    }
    
    // unisize対象外商品の場合に呼び出される
    func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didUnsupported message: String) {
        // ・・・ここに実行したいコードを実装します
    }
    
    // unisize の beid など unisize の CV タグに必要なデータの値更新時に実行される
    func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didBeidChanged beid: String, recommendedItems: String, bannerType: String) {
        // ・・・ここに実行したいコードを実装します
    }

    // unisize バナータップ時に実行される
    func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didBannerClicked: String, bannerType: String) {
        // ・・・ここに実行したいコードを実装します
    }
}
```

#### func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFinish message: String, bannerType: String)
UnisizeBannerWebview Class の処理完了時に実行される Delegate。  
unisize バナーの表示処理完了後にECアプリケーション側で処理を実行したい場合は、ここに実装します。（UI調整など）  
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| banner              | UnisizeBannerWebview       | UnisizeBannerWebview Class のインスタンスを取得できます。 |
| message             | String              | ※未使用(空)          |
| bannerType          | String              | バナータイプを返します。どのバナーで完了したのかを判定するのに利用します。 |
  
```swift
// コンポーネントの処理完了時に実行される
func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFinish message: String, bannerType: String) {
    // consoleに出力
    print("UnisizeBannerWebview bannerType: \(bannerType)")
}
```
  
##### 補足
TEXT バナーと EX バナーを実装する場合は、TEXT バナーの Delegate > `func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFinish message: String, bannerType: String)` のタイミングで EX バナーの .show() を実行するように実装してください。
これは TEXT バナーの表示完了後に、EX バナーの表示を実行しないと、API キャッシュが利用できないためです。  

```swift
func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFinish message: String, bannerType: String) {
    if bannerType == "text" {
        exBannerWebview?.show()
    }
}
```
  
#### func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFail errorObj: UnisizeError, bannerType: String) {
UnisizeBannerWebview Class の処理失敗時に実行される Delegate。  
  
unisize バナーのエラー発生時にECアプリケーション側で処理を実行したい場合は、ここに実装します。  
（バナー非表示などの UI 調整など）  
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| banner              | UnisizeBannerWebview       | UnisizeBannerWebview のインスタンスを取得できます。 |
| didFail             | [UnisizeError](#unisizeerror-class)        | UnisizeBannerWebview Class から返されたUnisizeError classを取得できます。<br>（※ UnisizeError classの変数、関数は下記UnisizeError class参照） |
| bannerType          | String              | バナータイプを返します。どのバナーで完了したのかを判定するのに利用します。  |
  
```swift
// コンポーネントの処理失敗時に実行される
func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didFail errorObj: UnisizeError, bannerType: String) {
    // consoleにエラーの内容を出力
    print("didFail: \(errorObj.getJsonString())")
        
    // バナーを非表示（バナーの UIView に制約を設定している場合）
    textBannerWebviewHeightConstraint.constant = 0
    textBannerWebview?.layoutIfNeeded()
    exBannerWebviewHeightConstraint.constant = 0
    exBannerWebview?.layoutIfNeeded()
    ciBannerWebviewHeightConstraint.constant = 0
    ciBannerWebview?.layoutIfNeeded()
}
```
  
#### func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didResized message: String, width: CGFloat, height: CGFloat, bannerType: String) {
UnisizeBannerWebview Class のバナーサイズ確定時に実行される Delegate。  
unisize では、アンケート前、アンケート後、比較アイテム登録後、ログイン、ログアウト後などで、バナーの表示が切り替わるため、バナーのデザインによっては、切り替わったタイミングでバナーの高さが変わる場合があります。そのため正しくバナーを表示、リサイズするために必須の処理となります。  
unisize バナーの表示処理完了時にECアプリケーション側で処理を実行したい場合は、ここに実装します。（UI調整など）  
  
| パラメーター           | 型                  | 説明                 |
| :------------------  | :------------------ | :------------------ |
| banner               | UnisizeBannerWebview       | UnisizeBannerWebview Class のインスタンスを取得できます。 |
| didResized (message) | String              | 未使用（空） |
| width                | CGFloat             | バナーレンダリング完了時に確定した width を取得できます。<br>（幅はバナータイプによって変動することはありません。そのためこのパラメーターは通常使用することはありません。） |
| height | CGFloat | バナーレンダリング完了時に確定した height を取得できます。<br>（高さはバナータイプによって変動します。） |
| bannerType | String | バナータイプを返します。どのバナーで完了したのかを判定するのに利用します。<br>（text、ex、ci） |
  
```swift
// コンポーネントのリサイズ時に実行される
func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didResized message: String, width: CGFloat, height: CGFloat, bannerType: String) {
    // consoleに出力
    print("unisizeBannerWebview didResized: width: \(width) height: \(height) type: \(bannerType)")
        
    // バナーのUIViewをサイズ変更（バナーのUIViewに制約を設定している場合）
    if (bannerType == "text") {
        textBannerWebviewHeightConstraint.constant = height
        textBannerWebview?.layoutIfNeeded()
    } else if (bannerType == "ex") {
        exBannerWebviewHeightConstraint.constant = height
        exBannerWebview?.layoutIfNeeded()
    } else if (bannerType == "ci") {
        ciBannerWebviewHeightConstraint.constant = height
        ciBannerWebview?.layoutIfNeeded()
    }
}
 ```
  
#### func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didUnsupported message: String) 
対象商品が unisize 対象外の場合に実行される Delegate。  
  
対象商品が unisize 対象外の場合にECアプリケーション側で処理を実行したい場合は、ここに実装します。  
（バナー非表示などのUI調整など）  
  
| パラメーター           | 型                  | 説明                 |
| :------------------  | :------------------ | :------------------ |
| didUnsupported (message)  | String         | 対象バナータイプの情報が返されます。（all：全てのバナーで対象外、ci：CIバナーのみ対象外） |

※ v1.1から didUnsupported (message) の内容をバナータイプを返すように変更しました。これはCIバナーの対応に伴い、TEXT、EXバナーではサポートしているが、CIバナーではサポートしていない商品（キッズ、バッグなど）があるための対応になります。
  
```swift
    // unisize対象外商品の場合に呼び出される
    func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didUnsupported message: String) {
        print("UnisizeBannerWebview didUnsupported: \(message)")
        
        // バナーのUIViewを非表示（バナーのUIViewに制約を設定している場合）
        if (message == "all") {
            // TEXTバナー、EXバナーを非表示
            textBannerWebviewHeightConstraint.constant = 0
            textBannerWebview?.layoutIfNeeded()
            exBannerWebviewHeightConstraint.constant = 0
            exBannerWebview?.layoutIfNeeded()
        }
        
        // CIバナーを非表示
        ciBannerWebviewHeightConstraint.constant = 0
        ciBannerWebview?.layoutIfNeeded()
    }

```
  
#### func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didBeidChanged beid: String, recommendedItems: String, bannerType: String) 
unisize の beid など unisize の CV タグに必要なデータの値の更新時に実行される Delegate。<br><br>
購入画面 → 購入完了画面が WkWebView で構成されているアプリの場合で、アプリの WkWebView の購入完了画面の HTML に埋め込まれているWeb 版  unisize の CV タグを、アプリでも利用したい場合に使用します。（UnisizeCvTag Classを使わないでコンバージョンを実装する場合。）<br><br>
実装方法など、詳しくは付属のドキュメント「unisizeのコンバージョンの実装について」をご覧ください。 

* unisizeSDK の UnisizeCvTag Class を使用して unisize のコンバージョンを実装する場合は、こちらの実装は不要です。
  
| パラメーター           | 型                  | 説明                 |
| :------------------  | :------------------ | :------------------ |
| didBeidChanged (beid)  | String         | unisizeのCVタグに必要なユーザー識別IDを返します。 |
| recommendedItems       | String         | unisizeのCVタグに必要なデータを情報を返します。（JSON形式） |
| bannerType             | String         | unisizeのバナータイプを返します。 |
  
* beid など unisize の CV タグに必要なデータは、unisize ログイン時、unisize ログアウト時、バナーのサイズのレコメンド時に値が変動します。<br>その都度 Delegate が実行されます。
  
```swift
    // unisize対象外商品の場合に呼び出される
    func unisizeBannerWebview(_ banner: UnisizeBannerWebview, didBeidChanged beid: String, recommendedItems: String, bannerType: String) {
        // consoleに情報を出力
        print("unisizeBannerWebview didBeidChanged: beid：\(beid)　recommendedItems：\(recommendedItems)　type：\(bannerType)")
        
        /* 
           取得した beid、recommendedItems を、購入画面の WkWWebView に Cookie、localStorage として書き込むことで、
           WKWebView の購入完了画面の HTML に埋め込まれている unisize の CV タグを、
           アプリでもそのまま利用したい場合に対応できるようになります。
        */

        ・・・
    }
```

##### Delegate で取得した値を、アプリの購入画面へ localStorage、Cookie としてセットする
上記 Delegate で取得した beid、recommendedItems は、ネイティブ側で変数として持ち回り、アプリの購入画面の UI 表示のタイミングに、アプリの購入画面の WkWebView に localStorage、Cookie として WkWebView にセットしてください。localStorage、Cookie の key は下記表をご覧ください。<br>
  
* アプリの購入完了画面の WkWebView の HTML に埋め込まれている Web 版 unisize の CV タグの読み込み前までにセットする必要があります。
  
| 種類                  | 変数（値）            | Key名                 | 用途                 |
| :------------------  | :------------------ | :------------------ | :------------------ |
| Cookie               | beid                | _unisize_beid              | ユーザー固有のユニークID
| localStorage         | beid                | _unisize_beid              | ユーザー固有のユニークID
| localStorage         | recommendedItems    | _unisize_recommended_items | 推奨アイテムの情報を保存するために使用（JSON形式）  |
  
**WkWebView に localStorage を書き込むためのサンプルコード**

```swift
let jsCode = """
	var recommendedItems = \(recommendedItems);
	if (!recommendedItems || recommendedItems === 'null' || recommendedItems === 'undefined') {
		recommendedItems = [];
	}
	
	localStorage.setItem('_unisize_recommended_items', JSON.stringify(recommendedItems));
	localStorage.setItem('_unisize_beid', '\(beid)');

	var date = new Date();
	date.setTime(date.getTime() + (365*24*60*60*1000));
	var expires = "; expires=" + date.toUTCString();
	document.cookie = "_unisize_beid=\(beid); path=/; expires=" + expires;
	"""

self.testWebView.evaluateJavaScript(jsCode) { (result, error) in
	if let error = error {
		print("Error: \(error)")
	} else {
		print("Success")
	}
}

```

<hr>
  
## UnisizeBanner Class （deprecated）

| Class               | 継承                |
| :------------------ | :------------------ |
| UnisizeBanner       | UIView, WKScriptMessageHandler |  
  
unisize バナー表示、unisize アンケート画面表示用 Class。EC アプリケーションの商品詳細画面のストーリーボード、ViewController に、バナー表示用の UIView を配置して、UnisizeBanner の初期化のタイミングで渡すことで、unisize バナーを表示することができます。  
unisize バナーの表示から、unisize アンケート画面の表示、アンケート結果を反映したサイズレコメンド処理までを一括で含んでいます。  
  
- 1つのインスタンスで全てのバナー表示に対応します。そのため一度の初期化で全てのバナーの UIView を渡す必要があります。
- 複数インスタンスでの利用はできません。
- SwiftUI や Flutter など Swift ではない UI フレームワーク上で実装する場合は、UnisizeBannerWebview Class をご利用ください。
- UnisizeBannerWebview Class と UnisizeBanner Class の併用はできません。
- 下位バージョンとの互換性で残しているため将来のバージョンで廃止する可能性がございます。
  
  <br>
  
| メソッド、プロパティ、 Delegate  | 説明 | 種類 |
| :------------------ | :------------------ | :------------------ |
| [init()](#init-メソッド-1) | UnisizeBanner の init メソッド。<br>（コンストラクタ） | メソッド<br>（コンストラクタ） |
| [setupParam()](#setupParam-メソッド-1) | パラメーターを再度設定してバナーの表示を更新します。 | メソッド |
| [reload()](#reload-メソッド-1) | unisize バナーをリロードします。 | メソッド |
| [close()](#close-メソッド-1) | UnisizeBanner Class の deinit メソッド。deinit の際に呼び出している処理と同一です。 | メソッド |
| [func unisizeBanner(_ banner: UnisizeBanner, didFinish:   String)](#func-unisizebanner_-banner-unisizebanner-didfinish-message-string) | UnisizeBanner class の処理完了時に実行される Delegate。 |  Delegate  |
| [func unisizeBanner(_ banner: UnisizeBanner, didFail:   UnisizeError)](#func-unisizebanner_-banner-unisizebanner-didfail-unisizeerror) | UnisizeBanner の処理失敗時に実行される Delegate。 |  Delegate  |
| [func unisizeBanner(_ banner: UnisizeBanner, didResized: String,   width: CGFloat, height: CGFloat, viewType: String)](#func-unisizebanner_-banner-unisizebanner-didresized-string-width-cgfloat-height-cgfloat-viewtype-string) | UnisizeBanner のバナーのリサイズ時に実行される Delegate。<br>（※ バナー単位で実行される） |  Delegate  |
| [func unisizeBanner(_ banner: UnisizeBanner, didLoaded: String, viewType: String) ](#func-unisizebanner_-banner-unisizebanner-didloaded-message-string)| UnisizeBanner のバナー読み込み完了時に実行される Delegate。<br>（※ バナー単位で実行される） |  Delegate  |
| [func unisizeBanner(_ banner: UnisizeBanner, didUnsupported: String)](#func-unisizebanner_-banner-unisizebanner-didunsupported-message-string) | 対象商品が unisize 対象外の場合に実行される Delegate。 |  Delegate  |
| [func unisizeBanner(_ banner: UnisizeBanner, didBeidChanged beid: String, recommendedItems: String, type: String)](#func-unisizebanner_-banner-unisizebanner-didbeidchanged-beid-string-recommendeditems-string-type-string) | 【v1.3追加】unisize の beid など unisize の CV タグに必要なデータの値の更新時に実行されます。 |  Delegate  |
  
  
### init() メソッド
UnisizeBanner Class の init メソッド（コンストラクタ）
TEXT バナー、EX バナー、CIバナーの表示に対応しています。（1画面に対して最大3つのバナーを表示可能） 
```swift
// ECアプリケーションの商品詳細画面の ViewControllerのviewDidLoad() 内で下記を実行

override func viewDidLoad() {
        super.viewDidLoad()
        
        // unisizeBannerの読み込み
        unisizeBanner = UnisizeBanner(
            textBannerRect: <バナーの表示エリアとして配置した UIView（TEXTバナー）>,
            exBannerRect: <バナーの表示エリアとして配置した UIView（EXバナー）>,
            ciBannerRect: <バナーの表示エリアとして配置した UIView（CIバナー）>,
            parentView: self,
            cid: <クライアントID>, 
            itm: ＜商品ID＞,
            cuid: ＜ECサイト側のユーザーID＞, 
            lang: ＜言語＞ 
            enableWebViewLog: true,
            enablePrintLog: true,
			sendErrorLog: true,
            delegate: self,
            customStyle: ＜バナーのカスタムスタイル＞
        )

    ・・・・

}
```  
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| textBannerRect   | UIView?                | TEXTバナー（バナー1）表示エリアとしてストーリーボードに配置した UIView を渡します。<br>※ TEXTバナーを表示しない場合は設定不要<br>※ unisize バナーロード後に、バナータイプに応じて UIView の高さの変更処理を Delegate で行えます。<br>※ バナーの表示・非表示、高さ変更によるレイアウト調整を行う場合は、制約を UIView に設定してコントロールしてください。 |
| exBannerRect     | UIView?                | EXバナー（バナー2）表示エリアとしてストーリーボードに配置したUIViewを渡します。<br>※ EXバナーを表示しない場合は設定不要<br>※ unisize バナーロード後に、バナータイプに応じて UIView の高さの変更処理を Delegate で行えます。<br>※ バナーの表示・非表示、高さ変更によるレイアウト調整を行う場合は、制約を UIView に設定してコントロールしてください。 |
| ciBannerRect     | UIView?                | CIバナー（バナー3）表示エリアとしてストーリーボードに配置したUIViewを渡します。<br>2024年半ばの unisize アップデートに伴い、EX バナーの上か下に CI バナーが自動的に表示される機能が追加されています。そのため、EX バナーの上か下に CI バナーが表示されている場合は、UnisizeBanner Classの 初期化時に CI バナー用の UIView を渡す必要はございません。CI バナーの表示位置を EX バナーとは離して配置したい場合にみご利用ください。<br>※ unisize バナーロード後に、バナータイプに応じて UIView の高さの変更処理を Delegate で行えます。<br>※ バナーの表示・非表示、高さ変更によるレイアウト調整を行う場合は、制約を UIView に設定してコントロールしてください。 |
| parentView       | UIViewController       | バナークリック時に unisize アンケート画面の表示処理で必要となります。<br>unsizeBanner class を呼び出した UIViewController Class（self）を渡します。 |
| cid              | String                 | クライアントID |
| itm              | String                 | アイテムID（アイテムごとに異なります） |
| cuid             | String?                | クライアントユーザーID<br>（ECアプリケーション（サイト）のユーザーログインID）<br>※ ユーザーがECアプリケーションにログインしている場合に必要となります。 |
| lang | String? | 表示言語<br>※ デフォルトは日本語：ja
| enableWebViewLog | Bool                   | console.log の内容を Xcode のコンソールに出力する
| enablePrintLog   | Bool                   | UnisizeBanner Class のデバッグログを Xcode のコンソールに出力する
| sendErrorLog     | Bool                   | エラー発生時にエラーログを unisize サーバーへ送信します
| delegate         | UnisizeBannerDelegate? |  Delegate を使用する場合は、self を渡してください。
| customStyle      | String?                | バナーにカスタムスタイルを適用する場合に使用します。<br>css を渡すことでバナーにカスタムスタイルを適用できます。<br>詳しくは付属のドキュメント「unisizeSDK Readme_iOS」の「バナーのカスタムスタイル適用について」を参照ください。（※）
  
* unisize では、バナーにカスタムスタイルを適用することで、unisize バナーのバージョンアップ時に表示崩れや不具合の原因となる可能性があるなどの点から、バナーのカスタマイズを推奨していません。ブランドイメージや、アプリの UI との兼ね合いで、どうしてもバナーカスタマイズが必要な場合に限定してご利用ください。
  
### setupParam() メソッド
パラメーターを設定して、バナーの表示を更新します。  
バナーの表示数は setupParam では変更不可。init()のタイミングで設定した textBannerRect、exBannerRect に依存します。  
組み込むアプリケーションの構造上、同一 ViewController のインスタンス内で、動的に表品を切り替えるような設計のアプリケーションの場合は、表品切り替えのタイミングで setupParam() メソッドを使ってバナーの商品情報も更新してください。  
  
```swift
unisizeBanner.setupParam(cid: cid, itm: itm, cuid: cuid, lang: lang)
```  
  
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| cid              | String?                 | クライアントID |
| itm              | String?                 | アイテムID（アイテムごとに異なります） |
| cuid             | String?                | クライアントユーザーID<br>（ECアプリケーション（サイト）のユーザーログインID）<br>※ ユーザーがECアプリケーションにログインしている場合に必要となります。 |
| lang | String? | 表示言語<br>※ デフォルトは日本語：ja

※ 渡したパラメーターのみが更新されます。

### reload() メソッド
unisize バナーをリロードします。  
  
通常SDKを使用する際に、reload() メソッドを使用することは想定していませんが、強制的にバナーを更新する必要がある場合のみ使用してください。  
  
※ パラメーターなし
  
### close() メソッド
unisize バナーの各変数を解放して閉じる処理を行います。  
deinit 時に呼び出している処理と同一になります。
  
通常 SDK を使用する際に、close() メソッドを使用することは想定していませんが、強制的に UnisizeBanner Class を解放する必要がある場合のみ使用してください。  
  
※ パラメーターなし
  
###  Delegate  の実装
UnisizeBanner class の完了時、バナーリサイズ時、エラー発生時などに、ECアプリケーション側で追加で処理を行う場合は、UnisizeBannerDelegate 内に実装を行います。  
バナーサイズ確定、バナー表示時にUIを調整したり、エラー発生時にユーザーに対して通知するといった場合に有用です。  
  
ECアプリケーションの商品詳細画面の ViewController で unsizeBanner class を初期化した後に、ViewController class（self）を渡して、extension 【商品詳細画面のViewController】: UnisizeBannerDelegate に下記を実装します。  

```swift
ECアプリケーションの商品詳細画面の ViewController に下記を実装

extension 【商品詳細画面のViewController】: UnisizeBannerDelegate {

    // コンポーネントの処理完了時に実行される
    func unisizeBanner(_ banner: UnisizeBanner, didFinish message: String) {
        // ここに処理を記載
    }
    
    // コンポーネントの処理失敗時に実行される
    func unisizeBanner(_ banner: UnisizeBanner, didFail: UnisizeError) // 処理失敗時に実行  {
         // ここに処理を記載
    }
    
    // コンポーネントのリザイズ時に実行される
    func unisizeBanner(_ banner: UnisizeBanner, didResized message: String, width: CGFloat, height: CGFloat, viewType: String)  {
         // ここに処理を記載
    }
    
    // WebViewのバナー表示時に毎回通知（リロードでも呼び出される）
    func unisizeBanner(_ banner: UnisizeBanner, didLoaded message: String, viewType: String)  {
         // ここに処理を記載
    }
    
    // unisize対象外商品の場合に呼び出される
    func unisizeBanner(_ banner: UnisizeBanner, didUnsupported message: String) {
         // ここに処理を記載
    }
    
    // unisizeのbeidなどunisizeのCVタグに必要なデータの値更新時に実行される（v1.3追加）
    func unisizeBanner(_ banner: UnisizeBanner, didBeidChanged beid: String, recommendedItems: String, type: String) {
         // ・・・ここに実行したいコードを実装します
    }
}
```

#### func unisizeBanner(_ banner: UnisizeBanner, didFinish message: String)
UnisizeBanner Class の処理完了時に実行される Delegate。  
  
unisize バナーの表示処理完了後にECアプリケーション側で処理を実行したい場合は、ここに実装します。（UI調整など）  
※ UnisizeBanner の処理が全て完了したタイミングで実行されます。  

| パラメーター          | 型                  | 説明
| :------------------ | :------------------ | :------------------
| banner              | UnisizeBanner       | UnisizeBanner のインスタンスを取得できます。
| message             | String              | ※未使用(空)

```swift
// コンポーネントの処理完了時に実行される
func unisizeBanner(_ banner: UnisizeBanner, didFinish message: String) {
    // consoleに出力
    print("unisizeBanner didFinish: message: \(message)")
}
```

#### func unisizeBanner(_ banner: UnisizeBanner, didFail: UnisizeError)
UnisizeBanner Class の処理失敗時に実行される Delegate。  
  
unisize バナーのエラー発生時にECアプリケーション側で処理を実行したい場合は、ここに実装します。  
（バナー非表示などのUI調整など）  
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| banner              | UnisizeBanner       | UnisizeBanner のインスタンスを取得できます。 |
| didFail             | [UnisizeError](#unisizeerror-class)        | UnisizeBannerClass から返されたUnisizeError classを取得できます。<br>（※UnisizeError classの変数、関数は下記UnisizeError class参照） |
  
```swift
// コンポーネントの処理失敗時に実行される
public func unisizeBanner(_ banner: UnisizeBanner, didFail errorObj: UnisizeError)  {
    // consoleに出力
    print("didFail: \(errorObj.getJsonString())")
        
    // バナーを非表示（バナーの UIView に制約を設定している場合）
    textBannerRectHeightConstraint.constant = 0
    textBannerRect.layoutIfNeeded()
    exBannerRectHeightConstraint.constant = 0
    exBannerRect.layoutIfNeeded()
}
```
  
#### func unisizeBanner(_ banner: UnisizeBanner, didResized: String, width: CGFloat, height: CGFloat, viewType: String)
UnisizeBanner のバナーサイズ確定時に実行される Delegate。  
unisize バナーの表示処理完了時にECアプリケーション側で処理を実行したい場合は、ここに実装します。（UI調整など） 
unisize では、アンケート前、アンケート後、比較アイテム登録後、ログイン、ログアウト後などで、バナーの表示が切り替わるため、バナーのデザインによっては、切り替わったタイミングでバナーの高さが変わる場合があります。そのため正しくバナーを表示、リサイズするために必須の処理となります。  
  
| パラメーター           | 型                  | 説明                 |
| :------------------  | :------------------ | :------------------ |
| banner               | UnisizeBanner       | UnisizeBanner のインスタンスを取得できます。 |
| didResized (message) | String              | 未使用（空） |
| width                | CGFloat             | バナーレンダリング完了時に確定した width を取得できます。<br>（幅はバナータイプによって変動することはありません。そのためこのパラメーターは通常使用することはありません。） |
| height | CGFloat | バナーレンダリング完了時に確定した height を取得できます。<br>（高さはバナータイプによって変動します。） |
| viewType | String | どの View のサイズかを確認するための値を取得できます。<br>text_banner：TEXTバナー（バナー1）<br>ex_banner：EXバナー（バナー2） |
  
```swift
// コンポーネントのリサイズ時に実行される
func unisizeBanner(_ banner: UnisizeBanner, didResized message: String, width: CGFloat, height: CGFloat, viewType: String) {
    // consoleに出力
    print("unisizeBanner didResized: width: \(width) height: \(height) type: \(viewType)")
        
    // バナーのUIViewをサイズ変更（バナーのUIViewに制約を設定している場合）
    if (viewType == "text_banner") {
        textBannerRectHeightConstraint.constant = height
        textBannerRect.layoutIfNeeded()
    } else if (viewType == "ex_banner") {
        exBannerRectHeightConstraint.constant = height
        exBannerRect.layoutIfNeeded()
    }
}
 ```

#### func unisizeBanner(_ banner: UnisizeBanner, didLoaded message: String)
UnisizeBanner のバナー表示完了時に実行される Delegate。  
unisize バナーの表示処理完了時にECアプリケーション側で処理を実行したい場合は、ここに実装します。（UI調整など）  
  
※バナー単位で実行されます。（message の値でバナーの判定可能）  

| パラメーター           | 型                  | 説明                 |
| :------------------  | :------------------ | :------------------ |
| banner               | UnisizeBanner       | UnisizeBanner のインスタンスを取得できます。 |
| didLoaded (message)  | String              | バナーの種類が返されます。 |
| viewType             | String              | どの View の表示が完了したかを確認するための値を取得できます。<br>text_banner：TEXTバナー（バナー1）<br>ex_banner：EXバナー（バナー2） |


```swift
// バナー表示完了時に毎回通知（バナーのリロードが発生した場合も実行される）
func unisizeBanner(_ banner: UnisizeBanner, didLoaded message: String, viewType: String) {
    // consoleに出力
    print("unisizeBanner didLoaded: message: \(message) type: \(viewType)")
}
```

#### func unisizeBanner(_ banner: UnisizeBanner, didUnsupported message: String)
対象商品が unisize 対象外の場合に実行される Delegate。  
  
対象商品が unisize 対象外の場合にECアプリケーション側で処理を実行したい場合は、ここに実装します。  
（バナー非表示などのUI調整など）  
  
| パラメーター           | 型                  | 説明                 |
| :------------------  | :------------------ | :------------------ |
| didUnsupported (message)  | String         | 対象バナータイプの情報が返されます。（all：全てのバナーで対象外、ci：CIバナーのみ対象外） |

※ v1.1からdidUnsupported (message) の内容をバナータイプを返すように変更しました。これは CI バナーの対応に伴い、TEXT、EX バナーではサポートしているが、CI バナーではサポートしていない商品（キッズ、バッグなど）があるための対応になります。
  
```swift
    // unisize対象外商品の場合に呼び出される
    func unisizeBanner(_ banner: UnisizeBanner, didUnsupported message: String) {
        // consoleに対象外のバナータイプを出力
        print("unisizeBanner didUnsupported: \(message)")
        
        // バナーのUIViewを非表示（バナーのUIViewに制約を設定している場合）
        if (message == "all") {
            // TEXTバナーを非表示
            textBannerViewHeightConstraint.constant = 0
            textBannerView.layoutIfNeeded()

            // EXバナーを非表示
            exBannerViewHeightConstraint.constant = 0
            exBannerView.layoutIfNeeded()
        }

        // CIバナーを非表示
        ciBannerViewHeightConstraint.constant = 0
        ciBannerView.layoutIfNeeded()
    }
```
  
#### func unisizeBanner(_ banner: UnisizeBanner, didBeidChanged beid: String, recommendedItems: String, type: String) 
【v1.3追加】unisize の beid など unisize の CV タグに必要なデータの値の更新時に実行される Delegate。<br><br>
購入画面 → 購入完了画面が WkWebView で構成されているアプリの場合で、アプリの WkWebView の購入完了画面の HTML に埋め込まれているWeb 版 unisize の CV タグを、アプリでも利用したい場合に使用します。（UnisizeCvTag Classを使わないでコンバージョンを実装する場合。）<br><br>
実装方法など、詳しくは付属のドキュメント「unisize のコンバージョンの実装について」をご覧ください。 

* unisizeSDK の UnisizeCvTag Class を使用して unisize のコンバージョンを実装する場合は、こちらの実装は不要です。
  
| パラメーター           | 型                  | 説明                 |
| :------------------  | :------------------ | :------------------ |
| didBeidChanged (beid)  | String         | unisizeのCVタグに必要なユーザー識別IDを返します。 |
| recommendedItems       | String         | unisizeのCVタグに必要なデータを情報を返します。（JSON形式） |
| type                   | String         | unisizeのバナータイプを返します。 |
  
* beid など unisize の CV タグに必要なデータは、unisize ログイン時、unisize ログアウト時、バナーのサイズのレコメンド時に値が変動します。<br>その都度 Delegate が実行されます。
  
```swift
    // unisize対象外商品の場合に呼び出される
    func unisizeBanner(_ banner: UnisizeBanner, didBeidChanged beid: String, recommendedItems: String, type: String)
        // consoleに情報を出力
        print("unisizeBanner didBeidChanged: beid：\(beid)　recommendedItems：\(recommendedItems)　type：\(type)")
        
        /* 
           取得した beid、recommendedItems を、購入画面の WkWWebView に Cookie、localStorage として書き込むことで、
           WKWebView の購入完了画面の HTML に埋め込まれている unisize の CV タグを、
           アプリでもそのまま利用したい場合に対応できるようになります。
        */

        ・・・
    }
```

##### Delegate で取得した値を、アプリの購入画面へ localStorage、Cookie としてセットする
上記 Delegate で取得した beid、recommendedItems は、ネイティブ側で変数として持ち回り、アプリの購入画面の UI 表示のタイミングに、アプリの購入画面の WkWebView に localStorage、Cookie として WkWebView にセットしてください。localStorage、Cookie の key は下記表をご覧ください。<br>

* アプリの購入完了画面の WkWebView の HTML に埋め込まれている Web 版 unisize の CV タグの読み込み前までにセットする必要があります。
  
| 種類                  | 変数（値）            | Key名                 | 用途                 |
| :------------------  | :------------------ | :------------------ | :------------------ |
| Cookie               | beid                | _unisize_beid              | ユーザー固有のユニークID
| localStorage         | beid                | _unisize_beid              | ユーザー固有のユニークID
| localStorage         | recommendedItems    | _unisize_recommended_items | 推奨アイテムの情報を保存するために使用（JSON形式）  |
  
**WkWebView に localStorage を書き込むためのサンプルコード**

```swift
let jsCode = """
	var recommendedItems = \(recommendedItems);
	if (!recommendedItems || recommendedItems === 'null' || recommendedItems === 'undefined') {
		recommendedItems = [];
	}
	
	localStorage.setItem('_unisize_recommended_items', JSON.stringify(recommendedItems));
	localStorage.setItem('_unisize_beid', '\(beid)');

	var date = new Date();
	date.setTime(date.getTime() + (365*24*60*60*1000));
	var expires = "; expires=" + date.toUTCString();
	document.cookie = "_unisize_beid=\(beid); path=/; expires=" + expires;
	"""

self.testWebView.evaluateJavaScript(jsCode) { (result, error) in
	if let error = error {
		print("Error: \(error)")
	} else {
		print("Success")
	}
}

```

<hr>
  
## UnisizeCVTag class

| Class               | 継承 |
| :------------------ | :------------------ |
UnisizeCVTag          | UIView     WKScriptMessageHandler |
  
unisize のコンバージョン集計用 class。ECアプリケーションの購入完了画面の ViewController に実装します。  
「02.unisize のコンバージョンの実装について（Swift）」も併せてご覧ください。

| メソッド、プロパティ、 Delegate  | 説明 | 種類 |
| :------------------ | :------------------ | :------------------ |
| [init()](#init-メソッド-2) | unisize   CVタグを処理する UnisizeCVTag の init メソッドです。（コンストラクタ） | メソッド（コンストラクタ） |
| [close()](#close-メソッド-2) | UnisizeCVTag Class の deinit メソッド。deinit の際に呼び出している処理と同一です。 | メソッド |
| [func unisizeBanner(_ banner: UnisizeBanner, didFinish:   String)](#func-unisizecvtag_-cvtag-unisizecvtag-didfinish-message-string) | UnisizeCVTag class の処理完了時に実行される Delegate。 |  Delegate  |
| [func unisizeBanner(_ banner: UnisizeBanner, didFail: String,   viewType: String)](#func-unisizecvtag_-cvtag-unisizecvtag-didfail-errorobj-unisizeerror) | UnisizeCVTag class の処理失敗時に実行される Delegate。 |  Delegate  |

### init() メソッド
unisizeCV タグの初期化からUIへコンバージョン集計を処理する UnisizeCVTag class の init メソッド（コンストラクタ）。
ECアプリケーションの購入完了画面の ViewController に実装します。

```swift
// ECアプリケーションの購入完了画面の ViewControllerで、viewDidLoad() のタイミングで下記を実行

// UnisizeCVTag のインスタンス生成
unisizeCvTag = UnisizeCVTag(
    cvTagRect: cvTagRect,
    cid: cid,
    cuid: cuid,
    purchaseid: purchaseid,
    itemnum: itemnum,
    itemid: itemid,
    price: price,
    size: size,
    iteminfo: iteminfo,
    iteminfojson: iteminfojson,
    enableWebViewLog: true,
    enablePrintLog: true,
	sendErrorLog: true,
    delegate: self
)
```

| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| cvTagRect           | UIView  | CVタグ表示エリアとして配置した UIView をセットします。<br>※集計用のため実際には何もUI上には表示しません。そのため、画面上の端に最小サイズで配置しても問題ありません。 |
| cid                 | String  | クライアントID |
| cuid                | String? | クライアントユーザーID<br>ECサイトのログインID<br>※ユーザーがECアプリケーションにログインしている場合<br>※ログイン前でcuidがない場合は空欄（""）にしてください。 |
| purchaseid          | String  | 購入時に発行された注文ID |
| itemnum             | String? | 購入数（アイテム毎）（※下記参照） |
| itemid              | String? | アイテム識別ID（商品ID）（アイテム毎）（※下記参照） |
| price               | String? | 購入したアイテムの金額（アイテム毎）（※下記参照） |
| size                | String? | 購入したアイテムのサイズ（アイテム毎）（※下記参照） |
| iteminfo            | String? | itemnum、itemid、price、size を一つのデータ形式にまとめたデータを渡します。<br>Web版 unisize のCVタグで data-iteminfo を使用している場合は、こちらをご利用ください。<br>使用しない場合は空欄（""）を渡してください。 （※下記参照） |
| iteminfojson        | String? | itemnum、itemid、price、size を json 形式にまとめたデータを渡します。<br>Web版 unisize のCVタグで data-iteminfojson を使用している場合は、こちらをご利用ください。<br>使用しない場合は空欄（""）を渡してください。 （※下記参照） |
| regtype             | String? | ※ 未使用。空欄（""）を渡してください。 |
| enableWebViewLog    | Bool    | console.log の内容を Xcode のコンソールに出力する |
| enablePrintLog      | Bool    | SDK のデバッグログを Xcode のコンソールに出力する |
| sendErrorLog        | Bool                   | エラー発生時にエラーログをunisizeサーバーへ送信します
| delegate            | UnisizeCVTagDelegate? |  Delegate を使用する場合は、selfを渡してください。 |

* CVタグのパラメーターの渡し方は、各クライアント様ごとに異なります。<br>itemnum、itemid、price、size を使用する方法、iteminfo、iteminfojson で渡す方法があります。<br>基本的にWeb版と同様のパラメーターにデータをセットして受け渡す形で問題ありません。itemnum、itemid、price、size を使用する方法で、複数商品の場合「#」（%23）区切りに変換して送信します。
* Shopfy など一部のECサービスの API では、価格が小数点で送られてくる場合がございます。unisize のコンバージョン処理では小数点はサポートしていないため、setupParam() 実行前に、各商品の価格を四捨五入してから追加してください。
* コンバージョンが正しく送信されているかは、パソコンと iPhone を USB で接続して、Safari を使った WkWebView デバッグを行い、対象の WkWebView の「ネットワーク」タブで「tracking」という項目を確認することで、コンバージョンが送信されているかの確認や、送信される値の確認を確認できます。
  
#### パラメーター実装例（itemnum、itemid、price、size を使用して購入商品を渡す場合）
※ 下記パラメーターは各パラメーターの受け渡し例で、パラメーターはサンプルです。実装する際に、発行されたクライアントID、購入時に発行された注文ID、購入した商品情報の値に置き換えてください。
```swift
let cid: String = "AbCdEfGhIjK" // クライアントID
let cuid: String = "AbCdEfGhIjK_log_testuser_001" // ECサイトの会員ID
let purchaseid: String = "AbCdEfGhIjK_1234567890" // 購入時に発行された注文ID
let itemnum: [String] = ["2", "1", "1", "1"]// 購入数（アイテム毎）
let itemid: [String] = ["A1234", "B6789", "C0987", "D54321"] // 購入アイテムのアイテムID
let price: [String] = ["4800", "7500", "980", "2980"] //購入アイテムの金額（アイテム毎）
let size: [String] = ["F", "M", "M", "M"] // 購入したアイテムのサイズ（アイテム毎）
    
// String 配列からCVタグが受け取れる形式に変換
let itemnumString = itemnum.joined(separator: "%23")
let itemidString = itemid.joined(separator: "%23")
let priceString = price.joined(separator: "%23")
let sizeString = size.joined(separator: "%23")

// UnisizeCVTag のインスタンス生成
unisizeCvTag = UnisizeCVTag(
    cvTagRect: cvTagRect,
    cid: cid,
    cuid: cuid,
    purchaseid: purchaseid,
    itemnum: itemnumString,
    itemid: itemidString,
    price: priceString,
    size: sizeString,
    iteminfo: "",
    iteminfojson: "",
    regType: "",
    enableWebViewLog: true,
    enablePrintLog: true,
    delegate:self
)
```

#### パラメーター実装例（iteminfo を使用して購入商品を渡す場合）
```swift
準備中
```

###  Delegate  の実装
 Delegate メソッドを使用する場合は、ECアプリケーションの購入完了画面の ViewController で unsizeCvTag class を初期化した後に、ViewController class（self）を渡して、extension 【購入完了画面の ViewController】: UnisizeCVTagDelegate に下記を実装します。  

```swift
ECアプリケーションの購入完了画面の ViewController に下記を実装

extension 【購入完了画面の ViewController】: UnisizeCVTagDelegate {

    // コンポーネントの処理完了時に実行される
    func unisizeCVTag(_ cvTag: UnisizeCVTag, didFinish message: String) {
        // ここに処理を記載
    }
    
    // コンポーネントの処理失敗時に実行される
    func unisizeCVTag(_ cvTag: UnisizeCVTag, didFail errorObj: UnisizeError) {
        // ここに処理を記載
    }
    
    // WebViewのバナー表示時に毎回通知（リロードでも呼び出される）
    func unisizeCVTag(_ cvTag: UnisizeCVTag, didLoaded message: String) {
        // ここに処理を記載
    }}
```
  
### close() メソッド
unisizeCVTag の各変数を解放して閉じる処理を行います。  
deinit 時に呼び出している処理と同一になります。
  
通常 SDK を使用する際に、close() メソッドを使用することは想定していませんが、強制的に UnisizeCVTag Class を解放する必要がある場合のみ使用してください。  
  
※ パラメーターなし
  
#### func unisizeCVTag(_ cvTag: UnisizeCVTag, didFinish message: String)
UnisizeCVTag Class の処理完了時に実行される Delegate。  
  
UnisizeCVTag class の表示処理完了後にECアプリケーション側で処理を実行したい場合は、ここに実装します。  
※ UnisizeCVTag class の処理が全て完了したタイミングで実行されます。  
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| cvTag               | UnisizeCVTag        | unisizeCVTag のインスタンスを取得できます。 |
| didFinish（message） | String             | ※ 未使用(空) |
  
```swift
// コンポーネントの処理完了時に実行される
func unisizeBanner(_ banner: UnisizeBanner, didFinish message: String) {
    // consoleに出力
    print("unisizeBanner didFinish: message: \(message)")
}
```

#### func unisizeCVTag(_ cvTag: UnisizeCVTag, didFail errorObj: UnisizeError)
UnisizeCVTag class の処理失敗時に実行される Delegate。  
  
UnisizeCVTag class のエラー発生時に、ECアプリケーション側で処理を実行したい場合は、ここに実装します。  
  
| パラメーター          | 型                  | 説明                 |
| :------------------ | :------------------ | :------------------ |
| cvTag | UnisizeCVTag | unisizeCVTagのインスタンスを取得できます。 |
| didFail（errorObj） | UnisizeError | UnisizeCVTag Class から返されたエラーメッセージを取得できます。 |
  
<hr>
  
## UnisizeError class

| Class               | 継承                |
| :------------------ | :------------------ |
UnisizeError | なし

UnisizeSDK でエラーが発生した際に、 Delegate で受け取ることができるエラー情報。  
エラー発生時にこの class からエラー関連の情報などを取得することができます。  
  
| メソッド、プロパティ、 Delegate  | 説明 | 種類|
| :------------------ | :------------------ | :------------------ |
[getJson()](#getjson-メソッド) | エラー情報を配列で返します。 | メソッド
[getJsonString()](#getJsonString-メソッド) | エラー情報をJson Stringで返します。 | メソッド

### getJson() メソッド

UnisizeSDK のエラー発生時に、エラーに関する全ての情報を JSONObject [String: Any] 形式で取得できます。
各コンポーネントの Delegate の didFail で取得可能。  
```swift
// コンポーネントの処理失敗時に実行される
public func unisizeBanner(_ banner: UnisizeBanner, didFail errorObj: UnisizeError)  {
    // consoleに出力
    print(errorObj.getJson())
}
```

| パラメーター          | 型                  | 説明 |
| :------------------ | :------------------ | :------------------ |
| 戻り値               | [String: Any] ※ JSONObject | エラー情報を JSONObject [String: Any] 形式で返します。 |

### getJsonString() メソッド
UnisizeSDK のエラー発生時に エラーに関する全ての情報を JSON String 形式で取得できます。  
各コンポーネントの Delegate の didFail で取得可能。  

```swift
// コンポーネントの処理失敗時に実行される
func unisizeCVTag(_ cvTag: UnisizeCVTag, didFail errorObj: UnisizeError)  {
    // consoleに出力
    print(errorObj.getJsonString())
}
```

| パラメーター          | 型                  | 説明 |
| :------------------ | :------------------ | :------------------ |
| 戻り値 | String | エラー情報を JSON String 形式で返します。 |


